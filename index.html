<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashio - Manajemen Keuangan Mahasiswa</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Font Lora -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Manifest untuk PWA -->
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --color-primary: #EBF4DD;
            --color-secondary: #90AB8B;
            --color-dark: #2C3E50;
            --color-warning: #E74C3C;
            --color-success: #27AE60;
        }
        
        * {
            font-family: 'Lora', serif;
        }
        
        body {
            background-color: var(--color-primary);
            color: var(--color-dark);
            padding-bottom: 80px;
        }
        
        .navbar, .footer {
            background-color: var(--color-secondary);
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: var(--color-secondary);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--color-secondary);
            border-color: var(--color-secondary);
        }
        
        .btn-primary:hover {
            background-color: #7A9775;
            border-color: #7A9775;
        }
        
        .btn-warning {
            background-color: #F39C12;
            border-color: #F39C12;
        }
        
        .btn-danger {
            background-color: var(--color-warning);
            border-color: var(--color-warning);
        }
        
        .budget-display {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-dark);
        }
        
        .remaining-budget {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .alert-warning {
            background-color: rgba(243, 156, 18, 0.2);
            border-color: #F39C12;
            color: #7E5109;
        }
        
        .expense-item {
            border-left: 5px solid var(--color-secondary);
            padding-left: 15px;
            margin-bottom: 10px;
        }
        
        .income-item {
            border-left: 5px solid var(--color-success);
            padding-left: 15px;
            margin-bottom: 10px;
        }
        
        .icon-lg {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        
        .progress {
            height: 20px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background-color: var(--color-secondary);
        }
        
        .day-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .day-bar {
            width: 12%;
            background-color: var(--color-secondary);
            border-radius: 5px 5px 0 0;
            position: relative;
            text-align: center;
            color: white;
            font-weight: bold;
        }
        
        .day-label {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            color: var(--color-dark);
        }
        
        .highest-day {
            background-color: #E74C3C;
        }
        
        .install-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: 1000;
            background-color: var(--color-secondary);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .section-title {
            border-bottom: 2px solid var(--color-secondary);
            padding-bottom: 5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 10px 0;
            text-align: center;
            color: white;
        }
        
        @media (max-width: 768px) {
            .budget-display {
                font-size: 1.5rem;
            }
            
            .remaining-budget {
                font-size: 1.8rem;
            }
        }
    </style>
    <!-- Ikon Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-money-bill-wave icon-lg"></i>
                <span class="fw-bold">Cashio</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#home"><i class="fas fa-home"></i> Beranda</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#history"><i class="fas fa-history"></i> Riwayat</a>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-sm btn-outline-light mt-1" id="resetBtn">
                            <i class="fas fa-redo"></i> Reset Data
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Bagian Input Anggaran dan Pemasukan -->
        <div id="home">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-wallet"></i> Anggaran Bulanan
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="monthlyBudget" class="form-label">Masukkan Anggaran Bulanan (Rp)</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rp</span>
                                    <input type="number" class="form-control" id="monthlyBudget" placeholder="Contoh: 2000000" min="0">
                                    <button class="btn btn-primary" id="setBudgetBtn">Set Anggaran</button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="incomeAmount" class="form-label">Tambah Pemasukan (Rp)</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rp</span>
                                    <input type="number" class="form-control" id="incomeAmount" placeholder="Contoh: 500000" min="0">
                                    <button class="btn btn-success" id="addIncomeBtn">Tambah Pemasukan</button>
                                </div>
                                <small class="text-muted">Pemasukan akan ditambahkan ke sisa anggaran.</small>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Catat semua pemasukan tambahan seperti uang saku ekstra, hasil freelance, atau hadiah.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-line"></i> Ringkasan Keuangan
                        </div>
                        <div class="card-body">
                            <div class="text-center">
                                <p class="text-muted mb-1">Total Anggaran</p>
                                <h2 class="budget-display" id="totalBudgetDisplay">Rp 0</h2>
                                
                                <p class="text-muted mb-1 mt-3">Total Pengeluaran</p>
                                <h3 class="text-danger" id="totalExpenseDisplay">Rp 0</h3>
                                
                                <p class="text-muted mb-1 mt-3">Sisa Uang Tersedia</p>
                                <h2 class="remaining-budget text-success" id="remainingBudgetDisplay">Rp 0</h2>
                                
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Penggunaan Anggaran</span>
                                        <span id="budgetPercentage">0%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" id="budgetProgressBar" role="progressbar" style="width: 0%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Peringatan jika pengeluaran > 50% -->
            <div class="alert alert-warning alert-dismissible fade" id="budgetWarning" role="alert">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Peringatan!</strong> Pengeluaran Anda telah mencapai <span id="warningPercentage">0%</span> dari anggaran bulanan.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                <div class="mt-2" id="savingTips"></div>
            </div>
            
            <!-- Bagian Input Pengeluaran -->
            <div class="card mt-4">
                <div class="card-header">
                    <i class="fas fa-shopping-cart"></i> Catat Pengeluaran Baru
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="expenseName" class="form-label">Nama Pengeluaran</label>
                                <input type="text" class="form-control" id="expenseName" placeholder="Contoh: Makan Siang">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="expenseAmount" class="form-label">Jumlah (Rp)</label>
                                <input type="number" class="form-control" id="expenseAmount" placeholder="Contoh: 25000" min="0">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="expenseCategory" class="form-label">Kategori</label>
                                <select class="form-select" id="expenseCategory">
                                    <option value="Makanan">Makanan</option>
                                    <option value="Transportasi">Transportasi</option>
                                    <option value="Hiburan">Hiburan</option>
                                    <option value="Belanja">Belanja</option>
                                    <option value="Pendidikan">Pendidikan</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="expenseDate" class="form-label">Tanggal</label>
                                <input type="date" class="form-control" id="expenseDate">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="addExpenseBtn">
                        <i class="fas fa-plus"></i> Tambah Pengeluaran
                    </button>
                </div>
            </div>
            
            <!-- Grafik Pengeluaran per Hari -->
            <div class="card mt-4">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i> Pengeluaran per Hari dalam Minggu Ini
                </div>
                <div class="card-body">
                    <div class="day-chart" id="dayChart">
                        <!-- Grafik akan di-generate oleh JavaScript -->
                    </div>
                    <p class="text-muted text-center mt-4">
                        <i class="fas fa-info-circle"></i> Grafik menunjukkan total pengeluaran Anda per hari dalam 7 hari terakhir.
                        Hari dengan pengeluaran tertinggi ditandai dengan warna merah.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Bagian Riwayat -->
        <div id="history" class="mt-5" style="display: none;">
            <div class="section-title">
                <i class="fas fa-history"></i>
                <h3 class="mb-0">Riwayat Pemasukan dan Pengeluaran</h3>
            </div>
            
            <ul class="nav nav-tabs" id="historyTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="expense-tab" data-bs-toggle="tab" data-bs-target="#expense-history">Pengeluaran</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="income-tab" data-bs-toggle="tab" data-bs-target="#income-history">Pemasukan</button>
                </li>
            </ul>
            
            <div class="tab-content mt-3">
                <!-- Tab Riwayat Pengeluaran -->
                <div class="tab-pane fade show active" id="expense-history" role="tabpanel">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Nama</th>
                                            <th>Kategori</th>
                                            <th>Jumlah</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expenseHistoryTable">
                                        <!-- Riwayat pengeluaran akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <p class="text-center text-muted" id="noExpenseHistory">Belum ada catatan pengeluaran.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Riwayat Pemasukan -->
                <div class="tab-pane fade" id="income-history" role="tabpanel">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Deskripsi</th>
                                            <th>Jumlah</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="incomeHistoryTable">
                                        <!-- Riwayat pemasukan akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <p class="text-center text-muted" id="noIncomeHistory">Belum ada catatan pemasukan.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tombol Install PWA -->
    <div class="install-btn" id="installButton">
        <i class="fas fa-download"></i>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <span>Cashio &copy; 2023 - Aplikasi Manajemen Keuangan Mahasiswa</span>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Data aplikasi
        let monthlyBudget = 0;
        let expenses = [];
        let incomes = [];
        let totalExpenses = 0;
        let totalIncomes = 0;
        
        // DOM Elements
        const monthlyBudgetInput = document.getElementById('monthlyBudget');
        const setBudgetBtn = document.getElementById('setBudgetBtn');
        const incomeAmountInput = document.getElementById('incomeAmount');
        const addIncomeBtn = document.getElementById('addIncomeBtn');
        const totalBudgetDisplay = document.getElementById('totalBudgetDisplay');
        const totalExpenseDisplay = document.getElementById('totalExpenseDisplay');
        const remainingBudgetDisplay = document.getElementById('remainingBudgetDisplay');
        const budgetPercentage = document.getElementById('budgetPercentage');
        const budgetProgressBar = document.getElementById('budgetProgressBar');
        const budgetWarning = document.getElementById('budgetWarning');
        const warningPercentage = document.getElementById('warningPercentage');
        const savingTips = document.getElementById('savingTips');
        
        const expenseNameInput = document.getElementById('expenseName');
        const expenseAmountInput = document.getElementById('expenseAmount');
        const expenseCategoryInput = document.getElementById('expenseCategory');
        const expenseDateInput = document.getElementById('expenseDate');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        
        const expenseHistoryTable = document.getElementById('expenseHistoryTable');
        const noExpenseHistory = document.getElementById('noExpenseHistory');
        const incomeHistoryTable = document.getElementById('incomeHistoryTable');
        const noIncomeHistory = document.getElementById('noIncomeHistory');
        
        const dayChart = document.getElementById('dayChart');
        
        const resetBtn = document.getElementById('resetBtn');
        const installButton = document.getElementById('installButton');
        
        // Tab navigation
        const homeSection = document.getElementById('home');
        const historySection = document.getElementById('history');
        const navbarLinks = document.querySelectorAll('.nav-link');
        
        // Inisialisasi tanggal default untuk input
        expenseDateInput.valueAsDate = new Date();
        
        // Event Listeners
        setBudgetBtn.addEventListener('click', setMonthlyBudget);
        addIncomeBtn.addEventListener('click', addIncome);
        addExpenseBtn.addEventListener('click', addExpense);
        resetBtn.addEventListener('click', resetData);
        installButton.addEventListener('click', installPWA);
        
        // Navigasi navbar
        navbarLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.getAttribute('href');
                
                if (target === '#home') {
                    homeSection.style.display = 'block';
                    historySection.style.display = 'none';
                } else if (target === '#history') {
                    homeSection.style.display = 'none';
                    historySection.style.display = 'block';
                    updateHistoryTables();
                }
                
                // Update active state
                navbarLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Fungsi untuk mengatur anggaran bulanan
        function setMonthlyBudget() {
            const budgetValue = parseInt(monthlyBudgetInput.value);
            
            if (isNaN(budgetValue) || budgetValue <= 0) {
                alert('Masukkan jumlah anggaran yang valid!');
                return;
            }
            
            monthlyBudget = budgetValue;
            monthlyBudgetInput.value = '';
            
            // Simpan ke localStorage
            saveData();
            
            // Update tampilan
            updateBudgetDisplay();
            showNotification('Anggaran bulanan berhasil disimpan!', 'success');
        }
        
        // Fungsi untuk menambah pemasukan
        function addIncome() {
            const incomeAmount = parseInt(incomeAmountInput.value);
            
            if (isNaN(incomeAmount) || incomeAmount <= 0) {
                alert('Masukkan jumlah pemasukan yang valid!');
                return;
            }
            
            const income = {
                id: Date.now(),
                amount: incomeAmount,
                date: new Date().toISOString().split('T')[0],
                description: 'Pemasukan Tambahan'
            };
            
            incomes.push(income);
            incomeAmountInput.value = '';
            
            // Simpan ke localStorage
            saveData();
            
            // Update tampilan
            updateBudgetDisplay();
            showNotification('Pemasukan berhasil ditambahkan!', 'success');
        }
        
        // Fungsi untuk menambah pengeluaran
        function addExpense() {
            const expenseName = expenseNameInput.value.trim();
            const expenseAmount = parseInt(expenseAmountInput.value);
            const expenseCategory = expenseCategoryInput.value;
            const expenseDate = expenseDateInput.value;
            
            if (expenseName === '') {
                alert('Masukkan nama pengeluaran!');
                return;
            }
            
            if (isNaN(expenseAmount) || expenseAmount <= 0) {
                alert('Masukkan jumlah pengeluaran yang valid!');
                return;
            }
            
            // Cek apakah anggaran sudah ditetapkan
            if (monthlyBudget === 0) {
                const setBudgetFirst = confirm('Anda belum menetapkan anggaran bulanan. Tetapkan anggaran terlebih dahulu atau lanjutkan tanpa anggaran?');
                if (setBudgetFirst) {
                    monthlyBudgetInput.focus();
                    return;
                }
            }
            
            const expense = {
                id: Date.now(),
                name: expenseName,
                amount: expenseAmount,
                category: expenseCategory,
                date: expenseDate
            };
            
            expenses.push(expense);
            
            // Reset form
            expenseNameInput.value = '';
            expenseAmountInput.value = '';
            expenseCategoryInput.value = 'Makanan';
            expenseDateInput.valueAsDate = new Date();
            
            // Simpan ke localStorage
            saveData();
            
            // Update tampilan
            updateBudgetDisplay();
            updateDayChart();
            showNotification('Pengeluaran berhasil dicatat!', 'success');
        }
        
        // Fungsi untuk menghapus pengeluaran
        function deleteExpense(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pengeluaran ini?')) {
                expenses = expenses.filter(expense => expense.id !== id);
                saveData();
                updateBudgetDisplay();
                updateHistoryTables();
                updateDayChart();
                showNotification('Pengeluaran berhasil dihapus!', 'info');
            }
        }
        
        // Fungsi untuk menghapus pemasukan
        function deleteIncome(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pemasukan ini?')) {
                incomes = incomes.filter(income => income.id !== id);
                saveData();
                updateBudgetDisplay();
                updateHistoryTables();
                showNotification('Pemasukan berhasil dihapus!', 'info');
            }
        }
        
        // Fungsi untuk memperbarui tampilan anggaran
        function updateBudgetDisplay() {
            // Hitung total pengeluaran
            totalExpenses = expenses.reduce((total, expense) => total + expense.amount, 0);
            
            // Hitung total pemasukan
            totalIncomes = incomes.reduce((total, income) => total + income.amount, 0);
            
            // Hitung sisa anggaran
            const remainingBudget = monthlyBudget + totalIncomes - totalExpenses;
            
            // Update tampilan
            totalBudgetDisplay.textContent = formatCurrency(monthlyBudget + totalIncomes);
            totalExpenseDisplay.textContent = formatCurrency(totalExpenses);
            remainingBudgetDisplay.textContent = formatCurrency(remainingBudget);
            
            // Hitung persentase penggunaan anggaran
            const totalAvailable = monthlyBudget + totalIncomes;
            let percentage = 0;
            
            if (totalAvailable > 0) {
                percentage = Math.min(100, Math.round((totalExpenses / totalAvailable) * 100));
            }
            
            budgetPercentage.textContent = `${percentage}%`;
            budgetProgressBar.style.width = `${percentage}%`;
            
            // Update warna sisa anggaran
            if (remainingBudget <= 0) {
                remainingBudgetDisplay.classList.remove('text-success');
                remainingBudgetDisplay.classList.add('text-danger');
            } else if (remainingBudget < monthlyBudget * 0.3) {
                remainingBudgetDisplay.classList.remove('text-success');
                remainingBudgetDisplay.classList.add('text-warning');
            } else {
                remainingBudgetDisplay.classList.remove('text-danger', 'text-warning');
                remainingBudgetDisplay.classList.add('text-success');
            }
            
            // Tampilkan peringatan jika pengeluaran mencapai atau melebihi 50%
            if (percentage >= 50 && totalAvailable > 0) {
                warningPercentage.textContent = `${percentage}%`;
                
                // Tambahkan tips penghematan
                let tips = '<strong>Tips Penghematan:</strong><ul class="mb-0 mt-1">';
                tips += '<li>Kurangi makan di luar, masak sendiri lebih hemat</li>';
                tips += '<li>Gunakan transportasi umum daripada taksi/ojol</li>';
                tips += '<li>Beli barang kebutuhan saat diskon atau promo</li>';
                tips += '<li>Batasi pengeluaran hiburan di akhir pekan</li>';
                tips += '</ul>';
                savingTips.innerHTML = tips;
                
                budgetWarning.classList.add('show');
            } else {
                budgetWarning.classList.remove('show');
            }
        }
        
        // Fungsi untuk memperbarui tabel riwayat
        function updateHistoryTables() {
            // Update tabel pengeluaran
            if (expenses.length === 0) {
                expenseHistoryTable.innerHTML = '';
                noExpenseHistory.style.display = 'block';
            } else {
                noExpenseHistory.style.display = 'none';
                let expenseRows = '';
                
                // Urutkan berdasarkan tanggal terbaru
                const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedExpenses.forEach(expense => {
                    expenseRows += `
                        <tr>
                            <td>${formatDate(expense.date)}</td>
                            <td>${expense.name}</td>
                            <td><span class="badge bg-secondary">${expense.category}</span></td>
                            <td class="text-danger">${formatCurrency(expense.amount)}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="deleteExpense(${expense.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                expenseHistoryTable.innerHTML = expenseRows;
            }
            
            // Update tabel pemasukan
            if (incomes.length === 0) {
                incomeHistoryTable.innerHTML = '';
                noIncomeHistory.style.display = 'block';
            } else {
                noIncomeHistory.style.display = 'none';
                let incomeRows = '';
                
                // Urutkan berdasarkan tanggal terbaru
                const sortedIncomes = [...incomes].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedIncomes.forEach(income => {
                    incomeRows += `
                        <tr>
                            <td>${formatDate(income.date)}</td>
                            <td>${income.description}</td>
                            <td class="text-success">${formatCurrency(income.amount)}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="deleteIncome(${income.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                incomeHistoryTable.innerHTML = incomeRows;
            }
        }
        
        // Fungsi untuk membuat grafik pengeluaran per hari
        function updateDayChart() {
            // Inisialisasi data untuk 7 hari terakhir
            const daysOfWeek = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            const dayData = {};
            
            // Inisialisasi dengan 0 untuk setiap hari
            daysOfWeek.forEach(day => {
                dayData[day] = 0;
            });
            
            // Hitung pengeluaran per hari dalam 7 hari terakhir
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(today.getDate() - 6);
            
            expenses.forEach(expense => {
                const expenseDate = new Date(expense.date);
                
                // Hanya hitung pengeluaran dalam 7 hari terakhir
                if (expenseDate >= sevenDaysAgo && expenseDate <= today) {
                    const dayName = daysOfWeek[expenseDate.getDay()];
                    dayData[dayName] += expense.amount;
                }
            });
            
            // Cari nilai maksimum untuk penskalaan grafik
            const maxExpense = Math.max(...Object.values(dayData));
            
            // Bersihkan grafik sebelumnya
            dayChart.innerHTML = '';
            
            // Buat grafik batang untuk setiap hari
            daysOfWeek.forEach(day => {
                const amount = dayData[day];
                let heightPercentage = 0;
                
                if (maxExpense > 0) {
                    heightPercentage = (amount / maxExpense) * 100;
                }
                
                const bar = document.createElement('div');
                bar.className = 'day-bar';
                bar.style.height = `${Math.max(10, heightPercentage)}%`;
                
                // Tandai hari dengan pengeluaran tertinggi
                if (amount > 0 && amount === maxExpense) {
                    bar.classList.add('highest-day');
                }
                
                // Tambahkan label nilai
                const valueLabel = document.createElement('div');
                valueLabel.className = 'value-label';
                valueLabel.textContent = amount > 0 ? formatCurrencyShort(amount) : '';
                valueLabel.style.position = 'absolute';
                valueLabel.style.top = '-25px';
                valueLabel.style.width = '100%';
                valueLabel.style.textAlign = 'center';
                valueLabel.style.fontSize = '0.8rem';
                valueLabel.style.color = 'var(--color-dark)';
                
                // Tambahkan label hari
                const dayLabel = document.createElement('div');
                dayLabel.className = 'day-label';
                dayLabel.textContent = day;
                
                bar.appendChild(valueLabel);
                bar.appendChild(dayLabel);
                dayChart.appendChild(bar);
            });
        }
        
        // Fungsi untuk mereset semua data
        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                monthlyBudget = 0;
                expenses = [];
                incomes = [];
                
                // Hapus dari localStorage
                localStorage.removeItem('cashioData');
                
                // Reset tampilan
                monthlyBudgetInput.value = '';
                incomeAmountInput.value = '';
                expenseNameInput.value = '';
                expenseAmountInput.value = '';
                expenseCategoryInput.value = 'Makanan';
                expenseDateInput.valueAsDate = new Date();
                
                updateBudgetDisplay();
                updateHistoryTables();
                updateDayChart();
                
                budgetWarning.classList.remove('show');
                
                showNotification('Semua data telah direset!', 'info');
            }
        }
        
        // Fungsi untuk menyimpan data ke localStorage
        function saveData() {
            const data = {
                monthlyBudget,
                expenses,
                incomes,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('cashioData', JSON.stringify(data));
        }
        
        // Fungsi untuk memuat data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('cashioData');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    monthlyBudget = data.monthlyBudget || 0;
                    expenses = data.expenses || [];
                    incomes = data.incomes || [];
                    
                    // Update tampilan dengan data yang dimuat
                    updateBudgetDisplay();
                    updateHistoryTables();
                    updateDayChart();
                    
                    showNotification('Data berhasil dimuat!', 'success');
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            }
        }
        
        // Fungsi untuk memformat mata uang
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        // Fungsi untuk memformat mata uang singkat
        function formatCurrencyShort(amount) {
            if (amount >= 1000000) {
                return `Rp${(amount / 1000000).toFixed(1)}jt`;
            } else if (amount >= 1000) {
                return `Rp${(amount / 1000).toFixed(0)}rb`;
            } else {
                return `Rp${amount}`;
            }
        }
        
        // Fungsi untuk memformat tanggal
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            // Buat elemen notifikasi
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show position-fixed`;
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '1050';
            notification.style.minWidth = '300px';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Tambahkan ke body
            document.body.appendChild(notification);
            
            // Hapus notifikasi setelah 3 detik
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // Mencegah tampilan prompt otomatis
            e.preventDefault();
            // Simpan event untuk digunakan nanti
            deferredPrompt = e;
            // Tampilkan tombol install
            installButton.style.display = 'flex';
        });
        
        function installPWA() {
            if (deferredPrompt) {
                // Tampilkan prompt instalasi
                deferredPrompt.prompt();
                
                // Lihat hasil instalasi
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        installButton.style.display = 'none';
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then((registration) => {
                    console.log('ServiceWorker registered dengan scope: ', registration.scope);
                }).catch((error) => {
                    console.log('ServiceWorker registration gagal: ', error);
                });
            });
        }
        
        // Inisialisasi aplikasi saat dimuat
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Set tanggal default untuk input tanggal
            expenseDateInput.valueAsDate = new Date();
            
            // Update grafik hari
            updateDayChart();
        });
        
        // Simulasi service worker untuk PWA (dalam satu file HTML)
        const serviceWorkerCode = `
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open('cashio-v1').then((cache) => {
                        return cache.addAll([
                            '/',
                            '/index.html',
                            '/manifest.json'
                        ]);
                    })
                );
            });
            
            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request).then((response) => {
                        return response || fetch(event.request);
                    })
                );
            });
        `;
        
        // Buat service worker secara dinamis jika diperlukan
        if ('serviceWorker' in navigator) {
            const blob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swURL);
        }
    </script>
    
    <!-- Manifest untuk PWA -->
    <script type="application/json" id="manifest-data">
        {
            "name": "Cashio",
            "short_name": "Cashio",
            "description": "Aplikasi Manajemen Keuangan untuk Mahasiswa",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#EBF4DD",
            "theme_color": "#90AB8B",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iOTYiIGN5PSI5NiIgcj0iODgiIGZpbGw9IiM5MEFCOEIiLz48cGF0aCBkPSJNMTIwIDEwNEg3MkM2NS4zNzMgMTA0IDYwIDEwOS4zNzMgNjAgMTE2VjE0NEM2MCAxNTAuNjI3IDY1LjM3MyAxNTYgNzIgMTU2SDEyMEMxMjYuNjI3IDE1NiAxMzIgMTUwLjYyNyAxMzIgMTQ0VjExNkMxMzIgMTA5LjM3MyAxMjYuNjI3IDEwNCAxMjAgMTA0Wk04NCAxMjRWODEuMkM4NCA3NC41NzMgODkuMzcyIDY4IDk2IDY4UzEwOCA3NC41NzMgMTA4IDgxLjJWMTA0SDg0Wk04NCAxMzZIMTA4VjE0NEg4NFYxMzZaIiBmaWxsPSIjRkJGQkZCIi8+PC9zdmc+",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        }
    </script>
    
    <script>
        // Buat manifest.json secara dinamis
        const manifestData = JSON.parse(document.getElementById('manifest-data').textContent);
        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.querySelector('link[rel="manifest"]').href = manifestURL;
    </script>
</body>
</html>